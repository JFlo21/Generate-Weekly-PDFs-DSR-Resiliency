<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weekly DSR PDFs</title>
    <!-- Bootswatch Flatly theme for modern look -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/flatly/bootstrap.min.css">
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <body class="bg-light">
    <main class="container py-4" id="root"></main>

    <script type="text/babel">
      // Elegant React table for accountants and billers
      function App() {
        const [data, setData] = React.useState([]);
        const [filter, setFilter] = React.useState('');
        const [sortConfig, setSortConfig] = React.useState({ key: 'work_request', direction: 'asc' });

        React.useEffect(() => {
          fetch('./assets/metadata.json')
            .then(res => res.json())
            .then(setData);
        }, []);

        const filtered = React.useMemo(() => {
          const term = filter.toLowerCase();
          return data.filter(item =>
            Object.values(item).some(v => String(v).toLowerCase().includes(term))
          );
        }, [data, filter]);

        const sorted = React.useMemo(() => {
          const sortedData = [...filtered];
          sortedData.sort((a, b) => {
            const aVal = String(a[sortConfig.key]).toLowerCase();
            const bVal = String(b[sortConfig.key]).toLowerCase();
            if (aVal < bVal) return sortConfig.direction === 'asc' ? -1 : 1;
            if (aVal > bVal) return sortConfig.direction === 'asc' ? 1 : -1;
            return 0;
          });
          return sortedData;
        }, [filtered, sortConfig]);

        const handleSort = key => {
          setSortConfig(prev =>
            prev.key === key
              ? { key, direction: prev.direction === 'asc' ? 'desc' : 'asc' }
              : { key, direction: 'asc' }
          );
        };

        return (
          <div>
            <header className="pb-3 mb-4 border-bottom">
              <h1 className="text-center">Weekly DSR PDFs</h1>
              <p className="text-center text-muted">Quick access for billing and accounting teams</p>
            </header>
            <div className="mb-3">
              <input
                type="text"
                className="form-control"
                placeholder="Search by name, foreman, week ending..."
                value={filter}
                onChange={e => setFilter(e.target.value)}
              />
            </div>
            <div className="table-responsive">
              <table className="table table-striped table-hover align-middle">
                <thead>
                  <tr>
                    <th role="button" onClick={() => handleSort('work_request')}>Work Request #</th>
                    <th role="button" onClick={() => handleSort('week_ending')}>Week Ending</th>
                    <th role="button" onClick={() => handleSort('foreman')}>Foreman</th>
                    <th role="button" onClick={() => handleSort('filename')}>File</th>
                    <th>View</th>
                  </tr>
                </thead>
                <tbody>
                  {sorted.map(item => (
                    <tr key={item.filename}>
                      <td>{item.work_request}</td>
                      <td>{item.week_ending}</td>
                      <td>{item.foreman}</td>
                      <td>{item.filename}</td>
                      <td>
                        <a href={`assets/${item.filename}`} target="_blank" rel="noopener" className="btn btn-sm btn-primary">
                          Open
                        </a>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
